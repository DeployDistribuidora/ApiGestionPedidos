@model Front_End_Gestion_Pedidos.Models.PedidoViewModel

@{
    ViewData["Title"] = "Nuevo Pedido";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
<h2 class="text-primary text-center mb-4">Nuevo Pedido</h2>

    <!-- Selección de Cliente -->
<form method="post" asp-action="ClienteSeleccionado">
<div class="mb-3">
<label for="cliente" class="form-label">Cliente</label>
<select id="cliente" name="clienteId" class="form-select" onchange="this.form.submit()">
                @foreach (var cliente in Model.Clientes)
                {
                    if (Model.ClienteSeleccionado?.Nro_Cliente == cliente.Nro_Cliente)
                    {
        <option value="@cliente.Nro_Cliente" selected="selected">
                            @cliente.Nombre_Cliente
        </option>
                    }
                    else
                    {
        <option value="@cliente.Nro_Cliente">
                            @cliente.Nombre_Cliente
        </option>
                    }


                }
</select>
</div>
</form>
<!-- Selección de Dirección -->
<div class="mb-3">
<label for="direccion" class="form-label">Dirección</label>
<select id="direccion" class="form-select">
            @if (Model.ClienteSeleccionado != null)
            {
    <option value="@Model.ClienteSeleccionado.Dir_Cliente">@Model.ClienteSeleccionado.Dir_Cliente</option>
    <option value="@Model.ClienteSeleccionado.Dir2_Cliente">@Model.ClienteSeleccionado.Dir2_Cliente</option>
            }
</select>
<button class="btn btn-link p-0 mt-1">+ Nueva dirección</button>
</div>

    <!-- Medio de Pago -->
<div class="mb-3">
<label for="medioPago" class="form-label">Medio de Pago</label>
<select id="medioPago" class="form-select">
<option value="Contado">Contado</option>
<option value="Credito">Credito</option>
<option value="Tarjeta">Tarjeta</option>
            } 
</select>
</div>

    <!-- Filtro de Productos -->
<div class="mb-2">
<label for="filtroProductos" class="form-label">Filtro de Productos</label>
<input type="text" id="filtroProductos" class="form-control" placeholder="Buscar producto..." />
<button type="button" class="btn btn-primary" p-0 mt-1" onchange="filtroStock()">Aplicar Filtro</button>
<button type="button" class="btn btn-primary" onchange="obtenerStock()" >Limpiar Filtro</button>
</div>

    <!-- Selección de Productos -->
<div class="mb-3">
<label class="form-label">Selección de productos y cantidad</label>
<div class="table-responsive">
<table class="table table-bordered">
<thead>
<tr>
<th>Nombre</th>
<th>Precio</th>
<th>Cantidad</th>
</tr>
</thead>
<tbody>
                    @foreach (var producto in Model.Productos)
                    {
    <tr>
    <td>@producto.Descripcion</td>
    <td>@producto.Precio</td>
    <td>
    <!-- Input de cantidad inicializado en 0 -->
    <input type="text" id="cantidad_@producto.Codigo" class="form-control text-center" value="0" readonly />
    </td>
    <td>
    <!-- Botones de acción -->
    <button type="button" class="btn btn-success btn-sm" onclick="incrementar('@producto.Codigo')">+</button>
    <button type="button" class="btn btn-danger btn-sm" onclick="decrementar('@producto.Codigo')">-</button>
    </td>
    </tr>
                    }
</tbody>
</table>
</div> 
</div>

    <!-- Comentarios -->
<div class="mb-3">
<label for="comentarios" class="form-label">Comentarios</label>
<textarea id="comentarios" class="form-control" rows="3"></textarea>
</div>

    <!-- Footer del Pedido -->
<div class="d-flex justify-content-between align-items-center">
<span class="text-danger fw-bold">Total $0</span>
<a href="#" class="text-decoration-none">Ver carrito</a>
<button type="button" class="btn btn-primary" onclick="enviarPedido()">Realizar Pedido</button>
</div>
</div>

<!-- Scripts con JavaScript básico para manipular los contadores -->
<script>
    const cantidades = {}; // Objeto para almacenar la cantidad por producto

    function incrementar(codigo) {
        if (!cantidades[codigo]) {
            cantidades[codigo] = 0;
        }
        cantidades[codigo]++;
        document.getElementById(`cantidad_${codigo}`).value = cantidades[codigo];
    }

    function decrementar(codigo) {
        if (cantidades[codigo] > 0) {
            cantidades[codigo]--;
            document.getElementById(`cantidad_${codigo}`).value = cantidades[codigo];
        }
    }

    function enviarPedido() {
        const pedido = [];

        // Recorrer el objeto cantidades para obtener los productos con cantidad
        for (const codigo in cantidades) {
            if (cantidades[codigo] > 0) {
                pedido.push({
                    codigo: codigo,
                    cantidad: cantidades[codigo]
                });
            }
        }

        // Enviar la información al servidor (aquí iría un fetch/post)
        console.log("Pedido a enviar:", pedido);

        // Ejemplo de fetch para enviar al controlador
        fetch('/Pedidos/RealizarPedido', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(pedido)
        })
            .then(response => {
                if (response.ok) {
                    alert('Pedido realizado con éxito.');
                } else {
                    alert('Error al realizar el pedido.');
                }
            })
            .catch(error => console.error('Error:', error));
    }
</script>