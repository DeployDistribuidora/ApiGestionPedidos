@inject IHttpContextAccessor HttpContextAccessor

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Gestión de Pedidos</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" />
    <link rel="stylesheet" href="~/css/custom.css" />
</head>
<body class="d-flex flex-column min-vh-100 bg-light text-dark">
    @if (!string.IsNullOrEmpty(HttpContextAccessor.HttpContext.Session.GetString("UsuarioLogueado")))
    {
        var role = HttpContextAccessor.HttpContext.Session.GetString("Role");
        var usuario = HttpContextAccessor.HttpContext.Session.GetString("UsuarioLogueado");

        <!-- Navbar lateral -->
        <nav id="sidebar" class="navbar navbar-light bg-white flex-column position-fixed vh-100 p-3 d-flex flex-column align-items-start">
            <button id="menuClose" class="btn btn-light align-self-start mb-3 d-lg-none" style="width: auto;">
                @* <span class="fw-bold">X</span> *@
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-truck-front-fill" viewBox="0 0 16 16">
                    <path d="M3.5 0A2.5 2.5 0 0 0 1 2.5v9c0 .818.393 1.544 1 2v2a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5V14h6v1.5a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5v-2c.607-.456 1-1.182 1-2v-9A2.5 2.5 0 0 0 12.5 0zM3 3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3.9c0 .625-.562 1.092-1.17.994C10.925 7.747 9.208 7.5 8 7.5s-2.925.247-3.83.394A1.008 1.008 0 0 1 3 6.9zm1 9a1 1 0 1 1 0-2 1 1 0 0 1 0 2m8 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2m-5-2h2a1 1 0 1 1 0 2H7a1 1 0 1 1 0-2" />
                </svg>
            </button>
            <ul class="navbar-nav flex-column w-100 mb-auto">
                @if (role == "Cliente")
                {
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Pedidos" asp-action="NuevoPedido">Nuevo pedido</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Pedidos" asp-action="BuscarPedidos">Buscar pedidos</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Productos" asp-action="Index">Productos</a></li>
                }
                else if (role == "Administracion")
                {
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Pedidos" asp-action="SupervisarPedidos">Supervisar pedido</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Pedidos" asp-action="NuevoPedido">Nuevo pedido</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Pedidos" asp-action="BuscarPedidos">Buscar pedidos</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Clientes" asp-action="Index">Clientes</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Productos" asp-action="Index">Productos</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" href="#">Métricas</a></li>
                }
                else if (role == "Supervisor de Carga")
                {
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Pedidos" asp-action="BuscarPedidos">Pedidos</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Pedidos" asp-action="SupervisarPedidos">Supervisar pedido</a></li>
                }
                else if (role == "Vendedor")
                {
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Pedidos" asp-action="NuevoPedido">Nuevo pedido</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Pedidos" asp-action="BuscarPedidos">Buscar pedidos</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Productos" asp-action="Index">Productos</a></li>
                    <li class="nav-item"><a class="nav-link fw-bold" asp-controller="Clientes" asp-action="Index">Clientes</a></li>
                }
            </ul>
            <div class="mt-auto w-100 text-center border-top pt-3">
                <span class="d-block mb-2">Usuario: <strong>@usuario</strong></span>
                <a class="btn btn-dark btn-sm w-100" asp-controller="Account" asp-action="Logout">Cerrar Sesión</a>
            </div>
        </nav>

        <!-- Contenido principal -->
        <main id="mainContent" class="flex-grow-1">
            <!-- Botón Hamburguesa -->
            <button id="menuToggle" class="btn btn-light position-fixed top-0 start-0 m-3 d-block d-lg-none" style="z-index: 1050;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-truck" viewBox="0 0 16 16">
                    <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5zm1.294 7.456A2 2 0 0 1 4.732 11h5.536a2 2 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456M12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2" />
                </svg>
            </button>

            <!-- Header -->
            <header class="bg-white py-3 text-center">
                <h1 class="fs-3 fw-bold">Gestión de Pedidos</h1>
            </header>

            <div class="p-4">
                @RenderBody()
            </div>
        </main>
    }

    <footer class="bg-light text-center py-3">
        <p class="m-0 text-dark">&copy; 2024 - Impact Computers</p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menuToggle');
        const menuClose = document.getElementById('menuClose');
        const navLinks = sidebar.querySelectorAll('.nav-link');

        // Verificar si es modo desktop
        function isDesktop() {
            return window.innerWidth >= 992; // 992px es el breakpoint de Bootstrap para desktop
        }

        // Toggle sidebar en mobile
        menuToggle.addEventListener('click', () => {
            if (!isDesktop()) {
                sidebar.style.transform = 'translateX(0%)';
                sidebar.style.zIndex = '2000'; // Asegura que esté por encima de otros elementos
            }
        });

        // Cerrar sidebar al hacer clic en "X" solo en mobile
        menuClose.addEventListener('click', () => {
            if (!isDesktop()) {
                sidebar.style.transform = 'translateX(-100%)';
            }
        });

        // Cerrar sidebar al seleccionar un enlace solo en mobile
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (!isDesktop()) {
                    sidebar.style.transform = 'translateX(-100%)';
                }
            });
        });


    </script>
</body>
</html>
